{
  "Name": "TA 1397 Dynamic rules - test all targets",
  "Skip": false,
  "Tests": [
    {
      "Name": "Test 1: Setup configuration",
      "Skip": false,
      "Steps": [
        {
          "Name": "Step: Create a dynamic rule with target ip",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-dynamic-rules",
            "Path": "/target_ip"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"target_ip\""
              },
              {
                "Key": "name",
                "Value": "\"target_ip\""
              },
              {
                "Key": "timeframe",
                "Value": "3"
              },
              {
                "Key": "threshold",
                "Value": "1"
              },
              {
                "Key": "action",
                "Value": "\"action-dynamic-rule-block\""
              },
              {
                "Key": "active",
                "Value": "true"
              },
              {
                "Key": "ttl",
                "Value": "3600"
              },
              {
                "Key": "tags",
                "Value": "[\"target_ip_1397\"]"
              },
              {
                "Key": "target",
                "Value": "\"ip\""
              },
              {
                "Key": "include",
                "Value": "[\"ip:102-38-248-254\"]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create a dynamic rule with target asn",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-dynamic-rules",
            "Path": "/target_asn"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"target_asn\""
              },
              {
                "Key": "name",
                "Value": "\"target_asn\""
              },
              {
                "Key": "timeframe",
                "Value": "3"
              },
              {
                "Key": "threshold",
                "Value": "1"
              },
              {
                "Key": "action",
                "Value": "\"action-dynamic-rule-block\""
              },
              {
                "Key": "active",
                "Value": "true"
              },
              {
                "Key": "ttl",
                "Value": "3600"
              },
              {
                "Key": "tags",
                "Value": "[\"target_asn_1397\"]"
              },
              {
                "Key": "target",
                "Value": "\"asn\""
              },
              {
                "Key": "include",
                "Value": "[\"ip:102-38-204-254\"]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create a dynamic rule with target country",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-dynamic-rules",
            "Path": "/target_country"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"target_country\""
              },
              {
                "Key": "name",
                "Value": "\"target_country\""
              },
              {
                "Key": "timeframe",
                "Value": "3"
              },
              {
                "Key": "threshold",
                "Value": "1"
              },
              {
                "Key": "action",
                "Value": "\"action-dynamic-rule-block\""
              },
              {
                "Key": "active",
                "Value": "true"
              },
              {
                "Key": "ttl",
                "Value": "3600"
              },
              {
                "Key": "tags",
                "Value": "[\"target_country_1397\"]"
              },
              {
                "Key": "target",
                "Value": "\"country\""
              },
              {
                "Key": "include",
                "Value": "[\"ip:104-250-30-254\"]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create a dynamic rule with target company",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-dynamic-rules",
            "Path": "/target_company"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"target_company\""
              },
              {
                "Key": "name",
                "Value": "\"target_company\""
              },
              {
                "Key": "timeframe",
                "Value": "3"
              },
              {
                "Key": "threshold",
                "Value": "1"
              },
              {
                "Key": "action",
                "Value": "\"action-dynamic-rule-block\""
              },
              {
                "Key": "active",
                "Value": "true"
              },
              {
                "Key": "ttl",
                "Value": "3600"
              },
              {
                "Key": "tags",
                "Value": "[\"target_company_1397\"]"
              },
              {
                "Key": "target",
                "Value": "\"company\""
              },
              {
                "Key": "include",
                "Value": "[\"ip:1-178-63-254\"]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create a dynamic rule with target headers_test",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-dynamic-rules",
            "Path": "/target_headers_test"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"target_headers_test\""
              },
              {
                "Key": "name",
                "Value": "\"target_headers_test\""
              },
              {
                "Key": "timeframe",
                "Value": "3"
              },
              {
                "Key": "threshold",
                "Value": "1"
              },
              {
                "Key": "action",
                "Value": "\"action-dynamic-rule-block\""
              },
              {
                "Key": "active",
                "Value": "true"
              },
              {
                "Key": "ttl",
                "Value": "3600"
              },
              {
                "Key": "tags",
                "Value": "[\"target_headers_test_1397\"]"
              },
              {
                "Key": "target",
                "Value": "\"headers_test\""
              },
              {
                "Key": "include",
                "Value": "[\"ip:103-101-84-254\"]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create a dynamic rule with target cookies_test",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-dynamic-rules",
            "Path": "/target_cookies_test"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"target_cookies_test\""
              },
              {
                "Key": "name",
                "Value": "\"target_cookies_test\""
              },
              {
                "Key": "timeframe",
                "Value": "3"
              },
              {
                "Key": "threshold",
                "Value": "1"
              },
              {
                "Key": "action",
                "Value": "\"action-dynamic-rule-block\""
              },
              {
                "Key": "active",
                "Value": "true"
              },
              {
                "Key": "ttl",
                "Value": "3600"
              },
              {
                "Key": "tags",
                "Value": "[\"target_cookies_test_1397\"]"
              },
              {
                "Key": "target",
                "Value": "\"cookies_test\""
              },
              {
                "Key": "include",
                "Value": "[\"ip:101-2-167-254\"]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create a dynamic rule with target arguments_test",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-dynamic-rules",
            "Path": "/target_arguments_test"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"target_arguments_test\""
              },
              {
                "Key": "name",
                "Value": "\"target_arguments_test\""
              },
              {
                "Key": "timeframe",
                "Value": "3"
              },
              {
                "Key": "threshold",
                "Value": "1"
              },
              {
                "Key": "action",
                "Value": "\"action-dynamic-rule-block\""
              },
              {
                "Key": "active",
                "Value": "true"
              },
              {
                "Key": "ttl",
                "Value": "3600"
              },
              {
                "Key": "tags",
                "Value": "[\"target_arguments_test_1397\"]"
              },
              {
                "Key": "target",
                "Value": "\"arguments_test\""
              },
              {
                "Key": "include",
                "Value": "[\"ip:123-123-123-129\"]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create security policy",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-security-policies",
            "Path": "/test-sp"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"test-sp\""
              },
              {
                "Key": "name",
                "Value": "\"test-sp\""
              },
              {
                "Key": "map",
                "Value": "[{\"id\":\"__root_entry__\",\"name\":\"__root__\",\"match\":\"^/(\\\\W.*)?$\",\"acl_profile\":\"__acldefault__\",\"acl_active\":true,\"backend_id\":\"__default__\",\"cloud_functions\":[],\"content_filter_profile\":\"__defaultcontentfilter__\",\"content_filter_active\":true,\"limit_ids\":[]},{\"id\":\"__default_entry__\",\"name\":\"__default__\",\"match\":\"/\",\"acl_profile\":\"__acldefault__\",\"acl_active\":true,\"backend_id\":\"__default__\",\"cloud_functions\":[],\"content_filter_profile\":\"__defaultcontentfilter__\",\"content_filter_active\":true,\"limit_ids\":[]}]"
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "Name": "Step: Create new server group 'test.site' ",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-server-groups",
            "Path": "/test-site"
          },
          "Method": "POST",
          "Payload": {
            "Params": [
              {
                "Key": "id",
                "Value": "\"test-site\""
              },
              {
                "Key": "name",
                "Value": "\"test-site\""
              },
              {
                "Key": "server_names",
                "Value": "[\"test.site\"]"
              },
              {
                "Key": "security_policy",
                "Value": "\"test-sp\""
              }
            ]
          },
          "Expected": {
            "Code": "201",
            "Type": "json",
            "Single": true,
            "SingleResult": [
              {
                "Key": "message",
                "Value": "Successfully created entry"
              }
            ]
          }
        },
        {
          "ID": "add-my-ip-to-trusted-source",
          "Skip": false
        },
        {
          "ID": "publish-changes",
          "Skip": false
        },
        {
          "ID": "wait-for-publish",
          "Skip": false
        }
      ]
    },
    {
      "Name": "Test: Send Traffic",
      "Skip": false,
      "Steps": [
        {
          "Name": "Step: Send Traffic to target ip 1",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "102.38.248.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target ip 2",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "102.38.248.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target asn 1",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "102.38.204.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target asn 2",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "102.38.204.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target country 1",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "104.250.30.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target country 2",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "104.250.30.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target company 1",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "1.178.63.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target company 2",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "1.178.63.254"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target headers_test 1",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "103.101.84.254"
            },
            {
              "Key": "test",
              "Value": "123"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target headers_test 2",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "103.101.84.254"
            },
            {
              "Key": "test",
              "Value": "123"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target cookies_test 1",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "101.2.167.254"
            },
            {
              "Key": "cookie",
              "Value": "test=456"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target cookies_test 2",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "101.2.167.254"
            },
            {
              "Key": "cookie",
              "Value": "test=456"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target arguments_test 1",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "123.123.123.129"
            }
          ],
          "Arguments": [
            {
              "Key": "test",
              "Value": "789"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "Name": "Step: Send Traffic to target arguments_test 2",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "123.123.123.129"
            }
          ],
          "Arguments": [
            {
              "Key": "test",
              "Value": "789"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "content",
            "Single": true,
            "Text": "b''"
          }
        },
        {
          "ID": "wait-1.5-minutes",
          "Skip": false
        },
        {
          "ID": "wait-for-publish",
          "Skip": false
        },
        {
          "Name": "Step: Send Traffic to target ip 3",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "102.38.248.254"
            }
          ],
          "Expected": {
            "Code": "474",
            "Type": "content",
            "Single": true,
            "Text": "b'access denied'"
          }
        },
        {
          "Name": "Step: Send Traffic to target asn 3",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "102.38.204.254"
            }
          ],
          "Expected": {
            "Code": "474",
            "Type": "content",
            "Single": true,
            "Text": "b'access denied'"
          }
        },
        {
          "Name": "Step: Send Traffic to target country 3",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "104.250.30.254"
            }
          ],
          "Expected": {
            "Code": "474",
            "Type": "content",
            "Single": true,
            "Text": "b'access denied'"
          }
        },
        {
          "Name": "Step: Send Traffic to target company 3",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "1.178.63.254"
            }
          ],
          "Expected": {
            "Code": "474",
            "Type": "content",
            "Single": true,
            "Text": "b'access denied'"
          }
        },
        {
          "Name": "Step: Send Traffic to target headers_test 3",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "103.101.84.254"
            },
            {
              "Key": "test",
              "Value": "123"
            }
          ],
          "Expected": {
            "Code": "474",
            "Type": "content",
            "Single": true,
            "Text": "b'access denied'"
          }
        },
        {
          "Name": "Step: Send Traffic to target cookies_test 3",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "101.2.167.254"
            },
            {
              "Key": "cookie",
              "Value": "test=456"
            }
          ],
          "Expected": {
            "Code": "474",
            "Type": "content",
            "Single": true,
            "Text": "b'access denied'"
          }
        },
        {
          "Name": "Step: Send Traffic to target arguments_test 3",
          "Skip": false,
          "API": {
            "Base": "send-traffic",
            "Path": ""
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "Host",
              "Value": "test.site"
            },
            {
              "Key": "x-forwarded-for",
              "Value": "123.123.123.129"
            }
          ],
          "Arguments": [
            {
              "Key": "test",
              "Value": "789"
            }
          ],
          "Expected": {
            "Code": "474",
            "Type": "content",
            "Single": true,
            "Text": "b'access denied'"
          }
        }
      ]
    },
    {
      "Name": "Test: Assert logs",
      "Skip": false,
      "Steps": [
        {
          "ID": "wait-for-logs",
          "Skip": false
        },
        {
          "Name": "Step: Get Logs for status 474",
          "Skip": false,
          "API": {
            "Base": "api-data",
            "Path": "/logs"
          },
          "Method": "GET",
          "Headers": [
            {
              "Key": "syntax",
              "Value": "string_query"
            }
          ],
          "Arguments": [
            {
              "Key": "limit",
              "Value": "200"
            },
            {
              "Key": "filters",
              "Value": "status = 474, timestamp between @@NOW(-3minutes)@@ and @@NOW(+1minutes)@@, branch=@@branch@@"
            }
          ],
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/tags/*",
                "Value": "dynamic-rule:target-arguments-test"
              },
              {
                "Key": "data/results/1/tags/*",
                "Value": "dynamic-rule:target-cookies-test"
              },
              {
                "Key": "data/results/2/tags/*",
                "Value": "dynamic-rule:target-headers-test"
              },
              {
                "Key": "data/results/3/tags/*",
                "Value": "dynamic-rule:target-company"
              },
              {
                "Key": "data/results/4/tags/*",
                "Value": "dynamic-rule:target-country"
              },
              {
                "Key": "data/results/5/tags/*",
                "Value": "dynamic-rule:target-asn"
              },
              {
                "Key": "data/results/6/tags/*",
                "Value": "dynamic-rule:target-ip"
              }
            ]
          }
        }
      ]
    },
    {
      "Name": "Test: Assert Quarantined page",
      "Skip": false,
      "Steps": [
        {
          "Name": "Step: POST query for target_ip",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-data",
            "Path": "/query"
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "provider",
              "Value": "mongodb"
            }
          ],
          "Payload": {
            "Params": [
              {
                "Key": "query",
                "Value": "{\"collection\":\"dynamic_rules_violations_active\",\"execute\":[{\"func\":\"find\",\"options\":{\"filter\":{\"rule_id\":\"target_ip\"}}}]}"
              }
            ]
          },
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/value",
                "Value": "102.38.248.254"
              },
              {
                "Key": "data/results/0/target",
                "Value": "ip"
              }
            ]
          }
        },
        {
          "Name": "Step: POST query for target_asn",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-data",
            "Path": "/query"
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "provider",
              "Value": "mongodb"
            }
          ],
          "Payload": {
            "Params": [
              {
                "Key": "query",
                "Value": "{\"collection\":\"dynamic_rules_violations_active\",\"execute\":[{\"func\":\"find\",\"options\":{\"filter\":{\"rule_id\":\"target_asn\"}}}]}"
              }
            ]
          },
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/value",
                "Value": "212238"
              },
              {
                "Key": "data/results/0/target",
                "Value": "asn"
              }
            ]
          }
        },
        {
          "Name": "Step: POST query for target_country",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-data",
            "Path": "/query"
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "provider",
              "Value": "mongodb"
            }
          ],
          "Payload": {
            "Params": [
              {
                "Key": "query",
                "Value": "{\"collection\":\"dynamic_rules_violations_active\",\"execute\":[{\"func\":\"find\",\"options\":{\"filter\":{\"rule_id\":\"target_country\"}}}]}"
              }
            ]
          },
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/value",
                "Value": "Haiti"
              },
              {
                "Key": "data/results/0/target",
                "Value": "country"
              }
            ]
          }
        },
        {
          "Name": "Step: POST query for target_company",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-data",
            "Path": "/query"
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "provider",
              "Value": "mongodb"
            }
          ],
          "Payload": {
            "Params": [
              {
                "Key": "query",
                "Value": "{\"collection\":\"dynamic_rules_violations_active\",\"execute\":[{\"func\":\"find\",\"options\":{\"filter\":{\"rule_id\":\"target_company\"}}}]}"
              }
            ]
          },
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/value",
                "Value": "HUAWEI CLOUDS"
              },
              {
                "Key": "data/results/0/target",
                "Value": "company"
              }
            ]
          }
        },
        {
          "Name": "Step: POST query for target_headers_test",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-data",
            "Path": "/query"
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "provider",
              "Value": "mongodb"
            }
          ],
          "Payload": {
            "Params": [
              {
                "Key": "query",
                "Value": "{\"collection\":\"dynamic_rules_violations_active\",\"execute\":[{\"func\":\"find\",\"options\":{\"filter\":{\"rule_id\":\"target_headers_test\"}}}]}"
              }
            ]
          },
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/value",
                "Value": "123"
              },
              {
                "Key": "data/results/0/target",
                "Value": "headers_test"
              }
            ]
          }
        },
        {
          "Name": "Step: POST query for target_cookies_test",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-data",
            "Path": "/query"
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "provider",
              "Value": "mongodb"
            }
          ],
          "Payload": {
            "Params": [
              {
                "Key": "query",
                "Value": "{\"collection\":\"dynamic_rules_violations_active\",\"execute\":[{\"func\":\"find\",\"options\":{\"filter\":{\"rule_id\":\"target_cookies_test\"}}}]}"
              }
            ]
          },
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/value",
                "Value": "456"
              },
              {
                "Key": "data/results/0/target",
                "Value": "cookies_test"
              }
            ]
          }
        },
        {
          "Name": "Step: POST query for target_arguments_test",
          "Skip": false,
          "GenerateID": false,
          "API": {
            "Base": "api-data",
            "Path": "/query"
          },
          "Method": "POST",
          "Headers": [
            {
              "Key": "provider",
              "Value": "mongodb"
            }
          ],
          "Payload": {
            "Params": [
              {
                "Key": "query",
                "Value": "{\"collection\":\"dynamic_rules_violations_active\",\"execute\":[{\"func\":\"find\",\"options\":{\"filter\":{\"rule_id\":\"target_arguments_test\"}}}]}"
              }
            ]
          },
          "Expected": {
            "Code": "200",
            "Type": "jsonpath",
            "Single": true,
            "SingleResult": [
              {
                "Key": "data/results/0/value",
                "Value": "789"
              },
              {
                "Key": "data/results/0/target",
                "Value": "arguments_test"
              }
            ]
          }
        }
      ]
    }
  ]
}
