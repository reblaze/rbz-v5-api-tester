{
    "Name": "My Test Suite",
    "Skip": false,
    "Tests": 
    [
        {
            "Name": "My Test",
            "Skip": false,
            "Steps":
            [
                {
                    "Name": "Create Rate limit with Name: 'My rate limit'",
                    "Skip": true,
                    "GenerateID": false,
                    "API": 
                    {
                        "Base": "rate-limit",
                        "Path": ""
                    },
                    "Method" :"POST",
                    "Payload":
                    {
                        "Template": "ratelimit.template",
                        "Defaults": "ratelimit.defaults",
                        "Params":
                        [
                            {
                                "Key": "name",
                                "Value": "\"My rate limit\""
                            },
                            {
                                "Key": "id",
                                "Value": "\"api_tester_cccbbbaaa\""
                            },
                            {
                                "Key": "active",
                                "Value": "true"
                            },
                            {
                                "Key": "threshold",
                                "Value": "1"
                            }

                        ]
                    },
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "json",
						"Single": true,
                        "SingleResult":
                        [
                            {
                                "Key": "ok",
                                "Value": true
                            }
                        ]
                    }
                },
                {
                    "Name": "Add Rate limit with Name: 'My rate limit' to default Security policy",
                    "Skip": true,
                    "GenerateID": false,
                    "API": 
                    {
                        "Base": "security-policy",
                        "Path": "__default__/"
                    },
                    "Method" :"PUT",
                    "Payload":
                    {
                        "Template": "securitypolicy.template",
                        "Defaults": "securitypolicy.defaults",
                        "Params":
                        [
                            {
                                "Key": "id",
                                "Value": "\"__default__\""
                            },
                            {
                                "Key": "map",
                                "Value": "[{\"id\": \"__root_entry__\", \"name\": \"__root__\", \"match\": \"^/(\\\\W.*)?$\", \"acl_profile\": \"__acldefault__\", \"acl_active\": true, \"backend_id\": \"__default__\", \"cloud_functions\": [], \"content_filter_profile\": \"__defaultcontentfilter__\", \"content_filter_active\": true, \"limit_ids\": []},{ \"id\": \"__default_entry__\", \"name\": \"__default__\", \"match\": \"/\", \"acl_profile\": \"__acldefault__\", \"acl_active\": true, \"backend_id\": \"__default__\", \"cloud_functions\": [], \"content_filter_profile\": \"__defaultcontentfilter__\", \"content_filter_active\": true, \"limit_ids\": [\"api_tester_cccbbbaaa\"]}]"
                            }
                        ]
                    },
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "json",
						"Single": true,
                        "SingleResult":
                        [
                            {
                                "Key": "ok",
                                "Value": true
                            }
                        ]
                    }
                },
                {
                    "Name": "List rate limits",
                    "Skip": true,
                    "GenerateID": false,
                    "API": 
                    {
                        "Base": "rate-limits",
                        "Path": ""
                    },
                    "Method" :"GET",
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "json",
						"Single": false,
                        "MultipleResults":
                        [
                            [
                                {
                                    "Key": "name",
                                    "Value": "My rate limit"
                                }
                            ]
                        ]
                    }
                },
                {
                    "Name": "Publish changes",
                    "Skip": true,
                    "GenerateID": false,
                    "Debug": {
                        "Level": "info",
                        "Message": "Calling publish changes, might take a few seconds"
                    },
                    "Method" :"PUT",
                    "API": 
                    {
                        "Base": "publish",
                        "Path": ""
                    },
                    "Payload":
                    {
                        "Template": "publish.template",
                        "Defaults": "publish.defaults",
                        "Params": []
                    },
                    "Expected":
                    {
                        "Code": "204",
                        "Type": "content",
						"Single": true,
                        "Text": "b''"
                    }
                },
                {
                    "Name": "Wait for Publish changes to take affect",
                    "Debug": {
                        "Level": "info",
                        "Message": "Actively waiting 30 seconds for publish to take effect"
                    },
                    "Skip": true,
                    "Python": true,
                    "Code": 
                    [
                        "import time",
                        "time.sleep(30)"
                    ]
                },
                {
                    "Name": "Send Traffic",
                    "Skip": true,
                    "API": 
                    {
                        "Base": "send-traffic",
                        "Path": ""
                    },
                    "Method": "GET",
                    "Headers":
                    [
                        {
                            "Key": "Host",
                            "Value": "default.site"
                        },
                        {
                            "Key": "test",
                            "Value": "366"
                        },
                        {
                            "Key": "Cookie",
                            "Value": "test=my-cookie"
                        }
                    ],
                    "Arguments":
                    [
                        {
                            "Key": "arg1",
                            "Value": "my first arg"
                        },
                        {
                            "Key": "arg2",
                            "Value": "my second arg"
                        },
                        {
                            "Key": "arg3",
                            "Value": "long arg aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
                        }
                    ],
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "content",
						"Single": true,
                        "Text": "b''"
                    }
                },
                {
                    "Name": "Send Traffic",
                    "Skip": true,
                    "API": 
                    {
                        "Base": "send-traffic",
                        "Path": "my-test"
                    },
                    "Method": "POST",
                    "Headers":
                    [
                        {
                            "Key": "Host",
                            "Value": "default.site"
                        },
                        {
                            "Key": "test",
                            "Value": "366"
                        },
                        {
                            "Key": "Cookie",
                            "Value": "test=my-cookie"
                        }
                    ],
                    "Arguments":
                    [
                        {
                            "Key": "arg1",
                            "Value": "my first arg"
                        },
                        {
                            "Key": "arg2",
                            "Value": "my second arg"
                        },
                        {
                            "Key": "arg3",
                            "Value": "long arg aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
                        }
                    ],
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "content",
						"Single": true,
                        "Text": "b''"
                    }
                },
                {
                    "Name": "Send Traffic",
                    "Skip": true,
                    "API": 
                    {
                        "Base": "send-traffic",
                        "Path": ""
                    },
                    "Method": "PUT",
                    "Headers":
                    [
                        {
                            "Key": "Host",
                            "Value": "default.site"
                        },
                        {
                            "Key": "test",
                            "Value": "366"
                        },
                        {
                            "Key": "Cookie",
                            "Value": "test=my-cookie"
                        }
                    ],
                    "Arguments":
                    [
                        {
                            "Key": "arg1",
                            "Value": "my first arg"
                        },
                        {
                            "Key": "arg2",
                            "Value": "my second arg"
                        },
                        {
                            "Key": "arg3",
                            "Value": "long arg aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
                        }
                    ],
                    "Files":
                    [
                        {
                            "Key": "file1",
                            "Value": "./test_files/1.png"
                        },
                        {
                            "Key": "file2",
                            "Value": "./test_files/2.png"
                        }
                    ],
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "content",
						"Single": true,
                        "Text": "b''"
                    }
                },
                {
                    "Name": "Send Traffic",
                    "Skip": false,
                    "API": 
                    {
                        "Base": "send-traffic",
                        "Path": "my-test-2"
                    },
                    "Method": "DELETE",
                    "Headers":
                    [
                        {
                            "Key": "Host",
                            "Value": "default.site"
                        },
                        {
                            "Key": "test",
                            "Value": "366"
                        },
                        {
                            "Key": "Cookie",
                            "Value": "test=my-cookie"
                        }
                    ],
                    "Arguments":
                    [
                        {
                            "Key": "arg1",
                            "Value": "my first arg"
                        },
                        {
                            "Key": "arg2",
                            "Value": "my second arg"
                        },
                        {
                            "Key": "arg3",
                            "Value": "long arg aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
                        }
                    ],
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "content",
						"Single": true,
                        "Text": "b''"
                    }
                },
                {
                    "Name": "Wait for Logs to be inserted to BQ",
                    "Debug": {
                        "Level": "info",
                        "Message": "Actively waiting 40 seconds for Logs to reach BQ"
                    },
                    "Skip": false,
                    "Python": true,
                    "Code": 
                    [
                        "import time",
                        "time.sleep(40)"
                    ]
                },
                {
                    "Name": "Get Logs",
                    "Skip": false,
                    "API": 
                    {
                        "Base": "logs",
                        "Path": ""
                    },
                    "Method": "GET",
                    "Headers":
                    [
                        {
                            "Key": "syntax",
                            "Value": "string_query"
                        }
                    ],
                    "Arguments":
                    [
                        {
                            "Key": "limit",
                            "Value": "200"
                        },
                        {
                            "Key": "filters",
                            "Value": "path=\"/my-test-2\", timestamp between @@NOW(-1minutes)@@ and @@NOW(+1minutes)@@, branch=@@branch@@"
                        }
                    ],
                    "Expected":
                    {
                        "Code": "200",
                        "Type": "jsonpath",
						"Single": true,
                        "SingleResult":
                        [
                            {
                                "Key": "data/results/0/tags/*",
                                "Value": "args:3"
                            },
                            {
                                "Key": "data/results/0/gf_triggers/0/trigger_name",
                                "Value": "API Discovery"
                            },
                            {
                                "Key": "data/results/0/gf_triggers/0/action",
                                "Value": "monitor"
                            }
                        ]
                    }
                }
            ]
        }
    ]
}

